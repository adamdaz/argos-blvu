---
title: "argos-blvu - 4. data analysis BLVU AGL analysis "
author: "Adam Duerr"
date: "`r Sys.Date()`"
output: html_document
---

notes: try to use all lowercase for files just to simplify typing and retyping the names
use git and renv to track changes to the project
git repo is https:/github.com/adamdaz/argos-blvu/

add info to each chunk to track whether it was run recently and how long it took
```{r}
# tic()
# 
# cat("
# Ran at: ");Sys.time()
# toc()
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


libraries
```{r}
library(usethis) #git stuff
library(renv) #versioning tools
library(tictoc) #tracking time
library(data.table) #allows multi-core processing for reading/writing tables = fast!
library(lme4)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ResourceSelection)
library(MuMIn)
```


read the data for analysis 
```{r}
tic()

blvu1<- fread("blvu1.csv")
colnames(blvu1)

cat("
Ran at: ");Sys.time()
toc()
```
Identify flying and perch locations
p = perch f = fly n = not used
```{r}
tic()

blvu1$p <- if_else((blvu1$kph < 1 & blvu1$agl < 50),"p", 
                   if_else((blvu1$agl < -50), "n", "f"))

fly1<- subset(blvu1, blvu1$p == "f")

#fly1$lnagl <- log(fly1$agl+0.1)

summary(fly1)

cat("
Ran at: ");Sys.time()
toc()
```

Look at agl data 
```{r}
tic()

ggplot(fly1, aes(agl)) + geom_boxplot()

cat("
Ran at: ");Sys.time()
toc()
```

Analysis of data for BLVU AGL

```{r}
tic()

glmm1 <- lmer (agl ~ poly(dems,2) + poly(drds,2) +  poly(slopes,2) + poly(east,2) + poly(north,2) + nlcdcat + tpicat + tricat + (1|id) , data = fly1 )

summary(glmm1)

cat("
Ran at: ");Sys.time()
toc()
```

check fit of model

```{r}
tic()

#residuals
rglmm1<- residuals (glmm1, type = "pearson")
#qqplot of residuals
qqnorm (rglmm1)
qqline (rglmm1)
# predicted fit
fglmm1 <- fitted(glmm1)
#plot residuals vs predicted fit
plot(fglmm1,rglmm1)


cat("
Ran at: ");Sys.time()
toc()
```

dredge 

```{r}
tic()

fly.dredge <- dredge(glmm1, rank = "AICc")

summary ()
cat("
Ran at: ");Sys.time()
toc()
```


model average


```{r}
tic()

mafly <- model.avg(fly.dredge)

cat("
Ran at: ");Sys.time()
toc()
```



